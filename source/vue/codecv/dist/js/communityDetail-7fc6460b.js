import{k as z,l as ie,m as re}from"./element-plus-38880127.js";import{U,H as ue,B as ae}from"./browseHistory-5e87323c.js";import{r as F,a4 as K,d as S,K as le,o as l,c as _,a as r,Z as ce,ak as me,u as t,T as de,i as pe,F as D,a6 as N,W as C,R as E,O as b,av as W,aw as Z,w as V,n as ve,V as B,U as q,j as w,J as O,k as ye,ax as G,L as fe,Q as J}from"./@vue-3ea1986a.js";import{P as he}from"./vue3-emoji-picker-8370cada.js";import{p as M,u as R,w as L,d as X,e as A,I as _e,_ as P,i as Y,E as ge,l as Ce}from"./index-651c7436.js";import{c as ee}from"./@vueuse-455f7559.js";import{n as j}from"./format-904828f9.js";import{s as te,d as oe}from"./index-c7bb1d4b.js";import{M as Ie}from"./highlight-a2ea8094.js";import{b as ke}from"./vue-router-c6ae1e2a.js";import{b as $e,l as be}from"./community-2790e0aa.js";import"./lodash-es-677d3ab7.js";import"./async-validator-604317c1.js";import"./@element-plus-974d1f7b.js";import"./dayjs-a5fda22c.js";import"./aos-80360ef4.js";import"./@ctrl-aa1b1e70.js";import"./escape-html-7294f491.js";import"./normalize-wheel-es-5e9aec41.js";import"./pinia-1bb501b6.js";import"./vue-demi-3c8f99f1.js";import"./picture-verification-code-77c40e50.js";import"./axios-578b17f9.js";import"./nprogress-6c9d9548.js";function Fe(e){return M("/communityComment/publish",e)}function Ee(e){return M("/communityComment/reply",e)}function Ae(e){return M("/communityComment/remove",e)}function Be(e){return M("/communityComment/queryCommentsByArticleId",e)}function Te(e){return M("/communityComment/queryCommentPosition",e)}function we(e){const o=F(!1);function s(){o.value=!o.value}function c(v){s(),e.value+=v.i}return{picker:o,togglePicker:s,setEmoji:c}}function De(e,o,s,c,v,u,y,f,p){const d=F(""),{loginState:a,loginModelToggle:h,userInfo:I}=R();async function n(){if(!a.logined){h();return}if(!d.value.trim()){L("\u4F60\u53D1\u4E2A\u7A7A\u5185\u5BB9\u662F\u60F3\u5E72\u561B\u5462\uFF1F\uFF1F\uFF1F");return}if(d.value.length>200){L("\u592A\u591A\u4E86\u5B58\u4E0D\u4E0B, \u5220\u5230200\u5B57\u4EE5\u5185\u5427");return}const i=o.value==1?Fe:Ee,g={content:d.value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),authorId:I.uid,images:p.value.join("~$^$~"),level:o.value,articleId:e.value,posterCommentId:s.value,replyAuthorId:c.value,replyArticleAuthorId:v.value,replyCommentId:u.value,replyCommentLevel:y.value},m=await i(g);m.code==200&&(d.value="",p.value.length=0,f("reQueryComments")),m.code==200?X(m.msg):A(m.msg)}return K(()=>{d.value="",p.value.length=0}),{shareMainContent:d,publish:ee(n,1e3)}}function Ne(){const e=F([]);async function o(){if(e.value.length>=2)return A("\u6700\u591A\u53EA\u80FD\u4E0A\u4F202\u5F20\u56FE\u7247\uFF01");const c=document.createElement("input");c.setAttribute("type","file"),c.setAttribute("accept",".png,.jpg,.gif,.jpeg,.webp"),c.click(),c.onchange=async function(){const v=Array.from(c.files);for(const u of v){const y=await _e(u);e.value.push(y)}c.remove()}}function s(c){e.value.splice(c,1)}return{images:e,pickerImage:o,deleteImage:s}}const ne=e=>(W("data-v-7d88f2c7"),e=e(),Z(),e),Me={class:"community-publish content-card"},Qe={class:"community-content-edit"},Se={key:0,class:"covers-container community-comment-cover"},Re=["onClick"],Pe={class:"community-operator-group flex community-content-edit-publish"},qe={class:"community-edit-picker"},Le=ne(()=>r("i",{class:"iconfont icon-emoji font-25 mr-10"},null,-1)),je=[Le],ze=ne(()=>r("i",{class:"iconfont icon-image font-25"},null,-1)),Ue=[ze],Ve=S({__name:"publish",props:{articleId:{},level:{},replyCommentLevel:{default:1},posterCommentId:{default:0},replyCommentId:{default:0},replyAuthorId:{default:0},replyArticleAuthorId:{default:0},background:{default:"var(--body-background)"}},emits:["reQueryComments"],setup(e,{emit:o}){const s=e,c=o,{pickerImage:v,images:u,deleteImage:y}=Ne(),f=le(s),{shareMainContent:p,publish:d}=De(f.articleId,f.level,f.posterCommentId,f.replyAuthorId,f.replyArticleAuthorId,f.replyCommentId,f.replyCommentLevel,c,u),{picker:a,setEmoji:h,togglePicker:I}=we(p);return(n,i)=>{const g=z;return l(),_("div",Me,[r("div",Qe,[ce(r("textarea",{style:de({background:n.background}),class:"content-edit main-content","onUpdate:modelValue":i[0]||(i[0]=m=>pe(p)?p.value=m:null),placeholder:"\u5185\u5BB9\u63A7\u5236\u5728200\u5B57\u4EE5\u5185\uFF5E"},null,4),[[me,t(p)]])]),t(u).length?(l(),_("div",Se,[(l(!0),_(D,null,N(t(u),(m,$)=>(l(),_("div",{class:"mr-10 cover-item-container",key:$},[b(g,{loading:"lazy",src:m,fit:"cover",class:"cover-item","initial-index":$,"preview-src-list":t(u),"preview-teleported":!0,"hide-on-click-modal":!0},null,8,["src","initial-index","preview-src-list"]),r("i",{onClick:k=>t(y)($),class:"iconfont icon-delete pointer hover cover-item-close"},null,8,Re)]))),128))])):C("",!0),r("div",Pe,[r("div",qe,[r("span",{class:"emoji pointer hover",onClick:i[1]||(i[1]=(...m)=>t(I)&&t(I)(...m))},je),r("span",{class:"emoji pointer hover",onClick:i[2]||(i[2]=(...m)=>t(v)&&t(v)(...m))},Ue),t(a)?(l(),E(t(he),{key:0,class:"picker",native:!0,"hide-search":!0,"hide-group-names":!0,onSelect:t(h),"static-texts":{skinTone:"\u6362\u80A4"}},null,8,["onSelect"])):C("",!0)]),r("button",{class:"btn primary",onClick:i[3]||(i[3]=(...m)=>t(d)&&t(d)(...m))},"\u53D1\u8868")])])}}});const H=P(Ve,[["__scopeId","data-v-7d88f2c7"]]);function se(e){const{userInfo:o}=R(),s=F(-1);let c=-1;function v(y){if(c===y){s.value=-1,c=-1;return}c=y,s.value=y}async function u(y,f,p){if(!Y()){A("\u8BF7\u5148\u767B\u5F55\uFF01"),window.location.reload();return}const d=await Ae({commentId:y,articleId:f,level:p});if(d.code==200){X(d.msg),e("reQueryComments");return}A(d.msg)}return{userInfo:o,reply:v,remove:u,currenId:s}}function He(e){const o=F(e>1);function s(){o.value=!1}return{more:o,setMore:s}}function xe(e){const o=F();return V(()=>e.value,()=>{try{ve(()=>{const s=o.value.children[e.value];te(oe(s)-65),s.classList.add("notice"),setTimeout(()=>{s.classList.remove("notice")},1e3)})}catch{A("\u51FA\u4E86\u70B9\u9519\uFF0C\u8BF7\u5237\u65B0\u540E\u91CD\u65B0\u5C1D\u8BD5\uFF5E")}}),{comments:o}}const Oe={class:"comments-list mt-20 content-card"},Je={class:"comment-content line-4"},Ke={class:"reply-text pointer"},We={key:0,class:"covers-container"},Ze={class:"list-style-init flex operator"},Ge=["onClick"],Xe=["onClick"],Ye=S({__name:"reply",props:{data:{},commentId:{},articleId:{}},emits:["reQueryComments"],setup(e,{emit:o}){const s=o,c=e,{currenId:v,reply:u,userInfo:y,remove:f}=se(s),{more:p,setMore:d}=He(c.data.length);return(a,h)=>{const I=z;return l(),_("div",Oe,[(l(!0),_(D,null,N(t(p)?a.data.slice(0,1):a.data,(n,i)=>(l(),_("div",{class:"comment-item",key:i},[b(U,{"user-info":n.authorInfo,"publish-time":n.createTime},null,8,["user-info","publish-time"]),r("p",Je,[r("span",Ke,"@"+B(n.replyNickName)+"\uFF1A",1),q(" "+B(n.content),1)]),n.images?(l(),_("div",We,[(l(!0),_(D,null,N(n.images.split("~$^$~"),(g,m)=>(l(),E(I,{key:m,src:g,"preview-src-list":n.images.split("~$^$~"),"initial-index":m,fit:"cover",loading:"lazy",lazy:!0,class:"mr-10 cover-item","preview-teleported":!0,"hide-on-click-modal":!0},null,8,["src","preview-src-list","initial-index"]))),128))])):C("",!0),r("ul",Ze,[r("li",{class:"mr-10",onClick:g=>t(u)(n.commentId)},"\u56DE\u590D",8,Ge),t(y).uid===n.authorId?(l(),_("li",{key:0,onClick:g=>t(f)(n.commentId,a.articleId,2)}," \u5220\u9664 ",8,Xe)):C("",!0)]),t(v)===n.commentId?(l(),E(H,{key:1,"article-id":a.articleId,level:2,"reply-comment-level":n.level,"poster-comment-id":a.commentId,"reply-comment-id":n.commentId,"reply-author-id":n.authorId,background:"white",onReQueryComments:h[0]||(h[0]=g=>a.$emit("reQueryComments"))},null,8,["article-id","reply-comment-level","poster-comment-id","reply-comment-id","reply-author-id"])):C("",!0)]))),128)),t(p)?(l(),_("span",{key:0,onClick:h[1]||(h[1]=(...n)=>t(d)&&t(d)(...n)),class:"pointer showMore"},"\u663E\u793A\u5168\u90E8...")):C("",!0)])}}});const et=P(Ye,[["__scopeId","data-v-6c84894a"]]),tt={class:"comments-container content-card"},ot={class:"tip"},nt={class:"comment-content line-4"},st={key:0,class:"covers-container"},it={class:"list-style-init flex operator"},rt=["onClick"],ut=["onClick"],at=S({__name:"comments",props:{data:{},articleId:{},pageNum:{},scrollTo:{},total:{},articleAuthorId:{},commentsTotal:{}},emits:["pageNumChange","reQueryComments"],setup(e,{emit:o}){const s=o,c=e,v=w(()=>c.scrollTo),{currenId:u,reply:y,userInfo:f,remove:p}=se(s),{comments:d}=xe(v);return(a,h)=>{const I=z,n=ie;return l(),_("div",tt,[r("span",ot,"\u672C\u9875\u8BC4\u8BBA/\u56DE\u590D\u5171 "+B(t(j)(a.total))+" \u6761",1),a.data.length?(l(),_("div",{key:0,class:"comments-list mt-20 content-card",ref_key:"comments",ref:d},[(l(!0),_(D,null,N(a.data,(i,g)=>(l(),_("div",{class:"comment-item",key:g},[b(U,{"user-info":i.authorInfo,"publish-time":i.createTime},null,8,["user-info","publish-time"]),r("p",nt,B(i.content),1),i.images?(l(),_("div",st,[(l(!0),_(D,null,N(i.images.split("~$^$~"),(m,$)=>(l(),E(I,{src:m,"preview-src-list":i.images.split("~$^$~"),key:$,"initial-index":$,fit:"cover",lazy:!0,loading:"lazy",class:"mr-10 cover-item","preview-teleported":!0,"hide-on-click-modal":!0},null,8,["src","preview-src-list","initial-index"]))),128))])):C("",!0),r("ul",it,[r("li",{class:"mr-10",onClick:m=>t(y)(i.commentId)},"\u56DE\u590D",8,rt),t(f).uid===i.authorId?(l(),_("li",{key:0,onClick:m=>t(p)(i.commentId,a.articleId,1)}," \u5220\u9664 ",8,ut)):C("",!0)]),t(u)===i.commentId?(l(),E(H,{key:1,"article-id":a.articleId,level:2,"poster-comment-id":i.commentId,"reply-comment-id":i.commentId,"reply-comment-level":i.level,"reply-author-id":i.authorId,"reply-article-author-id":a.articleAuthorId,onReQueryComments:h[0]||(h[0]=m=>a.$emit("reQueryComments"))},null,8,["article-id","poster-comment-id","reply-comment-id","reply-comment-level","reply-author-id","reply-article-author-id"])):C("",!0),i.children.length?(l(),E(et,{key:2,data:i.children,"comment-id":i.commentId,"article-id":a.articleId,onReQueryComments:h[1]||(h[1]=m=>a.$emit("reQueryComments"))},null,8,["data","comment-id","article-id"])):C("",!0)]))),128))],512)):C("",!0),a.data.length?(l(),E(n,{key:1,background:"",layout:"prev, pager, next",total:a.commentsTotal,class:"mt-4 mt-20","current-page":a.pageNum,onCurrentChange:h[2]||(h[2]=i=>a.$emit("pageNumChange",i))},null,8,["total","current-page"])):C("",!0),a.data.length?C("",!0):(l(),E(ge,{key:2,title:"\u8FD8\u6CA1\u6709\u4EBA\u53D1\u8868\u8BC4\u8BBA..."}))])}}});const lt=P(at,[["__scopeId","data-v-063aa4b3"]]);function ct(e,o){const s=O({title:"",content:"",professional:"",authorId:0,likes:[],commentTotal:0,hot:0,createTime:"",updateTime:"",articleId:e.value,introduce:"",authorInfo:Ce,comments:[]}),c=F(0),v=F(0),u=O({pageNum:1,pageSize:10,articleId:e.value}),y=F();async function f(){if(!e.value){A("\u51FA\u9519\u4E86");return}const n=await $e({articleId:e.value});n.code==200&&mt(s,n.data)}async function p(){u.articleId=e.value;const n=await Be(u);n.code==200&&(s.comments=n.data,c.value=n.total,v.value=n.commentsTotal)}function d(){const n=document.querySelector(".anchor");te(oe(n)-65)}function a(n){u.pageNum=n,p(),d()}async function h(n){if(!Y())return A("\u8BF7\u5148\u767B\u5F55");if(n){L("\u70B9\u8FC7\u8D5E\u4E86, \u4E0D\u7528\u518D\u70B9\u4E86\uFF5E");return}const{userInfo:i}=R(),{code:g}=await be({articleId:e.value,userId:i.uid});g==200&&s.likes.push(i.uid)}const I=ee(function(){isNaN(e.value)||(p(),f())});return V(()=>e.value,()=>{I()}),ye(async()=>{if(isNaN(o.value))return;const{data:n,code:i,msg:g}=await Te({commentId:o.value,pageSize:u.pageSize,articleId:e.value});i===200?(u.pageNum=n.pageNum,s.comments=n.data,y.value=n.position):A(g)}),G(I),K(()=>s.content=""),{commentsConditions:u,total:c,position:y,commentsTotal:v,article:s,like:h,queryArticle:f,pageNumChange:a,queryComments:p,toCommentFieldTop:d}}function mt(e,o){e.articleId=o.articleId,e.title=o.title,e.content=o.content,e.commentTotal=o.commentTotal,e.professional=o.professional,e.authorId=o.authorId,e.likes=o.likes,e.createTime=o.createTime,e.updateTime=o.updateTime,e.introduce=o.introduce,e.authorInfo=o.authorInfo}function dt(e){const o=F(!1);function s(){o.value=!1,setTimeout(()=>o.value=!0,200)}return G(()=>{s()}),V(()=>e.value,()=>{s()}),{delay:o}}const Q=e=>(W("data-v-0dbb6118"),e=e(),Z(),e),pt={class:"community-detail flex"},vt={class:"main-content mr-20"},yt={class:"main content-card"},ft=["innerHTML"],ht={class:"supports mb-20"},_t=Q(()=>r("i",{class:"iconfont icon-like font-20"},null,-1)),gt=Q(()=>r("i",{class:"iconfont icon-comment font-20"},null,-1)),Ct=Q(()=>r("i",{class:"iconfont icon-share font-20"},null,-1)),It=Q(()=>r("i",{class:"iconfont icon-edit font-20"},null,-1)),kt={class:"pointer tag mr-20"},$t=Q(()=>r("i",{class:"anchor"},null,-1)),bt={class:"slide-content"},Ft=S({__name:"communityDetail",setup(e){const o=ke(),s=w(()=>parseInt(o.query.articleId)),c=w(()=>parseInt(o.query.posterCommentId)),{userInfo:v}=R(),{article:u,total:y,position:f,commentsTotal:p,like:d,pageNumChange:a,toCommentFieldTop:h,queryComments:I,commentsConditions:n}=ct(s,c),{delay:i}=dt(s),g=w(()=>u.likes.includes(v.uid)),m=w(()=>u.authorId==v.uid);return($,k)=>{const x=re;return l(),_("div",pt,[r("div",vt,[r("div",yt,[b(U,{class:"user-info","user-info":t(u).authorInfo,"publish-time":t(u).createTime},null,8,["user-info","publish-time"]),r("article",{class:"content",innerHTML:t(u).content},null,8,ft),r("div",ht,[r("span",{onClick:k[0]||(k[0]=T=>t(d)(g.value)),class:fe({clicked:g.value})},[_t,q(" "+B(t(j)(t(u).likes.length)),1)],2),r("span",{onClick:k[1]||(k[1]=(...T)=>t(h)&&t(h)(...T))},[gt,q(" "+B(t(j)(t(u).comments.length)),1)]),r("span",null,[b(x,{placement:"bottom",content:"\u5206\u4EAB\u7ED9\u670B\u53CB"},{default:J(()=>[Ct]),_:1})]),m.value?(l(),_("span",{key:0,onClick:k[2]||(k[2]=T=>$.$router.push(`/community/editor?articleId=${s.value}`))},[b(x,{placement:"bottom",content:"\u7F16\u8F91"},{default:J(()=>[It]),_:1})])):C("",!0)]),r("span",kt,"#"+B(t(u).professional),1),r("span",{class:"pointer hover",onClick:k[3]||(k[3]=T=>$.$router.back())},"\u8FD4\u56DE\u4E0A\u4E00\u9875"),r("span",{class:"pointer hover back absolute",onClick:k[4]||(k[4]=T=>$.$router.back())},"\u8FD4\u56DE\u4E0A\u4E00\u9875")]),b(H,{"article-id":s.value,level:1,"reply-article-author-id":t(u).authorId,onReQueryComments:t(I)},null,8,["article-id","reply-article-author-id","onReQueryComments"]),$t,b(lt,{data:t(u).comments,"article-id":s.value,total:t(y),"page-num":t(n).pageNum,"scroll-to":t(f),"comments-total":t(p),"article-author-id":t(u).authorId,onPageNumChange:t(a),onReQueryComments:t(I)},null,8,["data","article-id","total","page-num","scroll-to","comments-total","article-author-id","onPageNumChange","onReQueryComments"])]),r("div",bt,[b(ue,{class:"slide-item"}),b(ae),t(i)?(l(),E(Ie,{key:0,class:"slide-item menu-bar content-card",body:".content",style:{width:"300px"}})):C("",!0)])])}}});const Zt=P(Ft,[["__scopeId","data-v-0dbb6118"]]);export{Zt as default};
