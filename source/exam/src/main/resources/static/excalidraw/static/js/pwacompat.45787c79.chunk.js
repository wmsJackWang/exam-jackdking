"use strict";(self.webpackChunkexcalidraw=self.webpackChunkexcalidraw||[]).push([[2967],{7974:()=>{!function(){if(!("onload"in XMLHttpRequest.prototype)||navigator.standalone)return;const t=!1,e=["standalone","fullscreen","minimal-ui"],n="#f8f9fa",o=24,a="HelveticaNeue-CondensedBold",r=128,i=48,c=20,s=120,l=navigator.userAgent||"",p=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")&&(-1!==l.indexOf("Mobile/")||"standalone"in navigator)||t,u=Boolean(l.match(/(MSIE |Edge\/|Trident\/)/)),d="undefined"!==typeof Windows;let f,h;try{h=sessionStorage}catch(_){}function m(t){try{return document.head.querySelector(t)}catch(_){return null}}function g(t,e){const n="__pwacompat_"+t;return void 0!==e&&(h[n]=e),h[n]}function w(){f=m('link[rel="manifest"]');const t=f?f.href:"";if(!t)throw'can\'t find <link rel="manifest" href=".." />\'';const e=function(t){for(let e=0;e<t.length;++e){const n=t[e];try{return new URL("",n),t=>new URL(t||"",n).toString()}catch(_){}}return t=>t||""}([t,location]),n=g("manifest");if(n){try{x(JSON.parse(n),e)}catch(a){console.warn("PWACompat error",a)}return}const o=new XMLHttpRequest;o.open("GET",t),o.withCredentials="use-credentials"===f.getAttribute("crossorigin"),o.onload=()=>{try{const t=JSON.parse(o.responseText);g("manifest",o.responseText),x(t,e)}catch(a){console.warn("PWACompat error",a)}},o.send(null)}function b(t,e,n){if(m(t+n))return;const o=document.createElement(t);for(const a in e)o.setAttribute(a,e[a]);return document.head.appendChild(o),o}function y(t,e){e&&(!0===e&&(e="yes"),b("meta",{name:t,content:e},'[name="'.concat(t,'"]')))}function v(t){const e=t.sizes.split(/\s+/g).map((t=>"any"===t?1/0:parseInt(t,10)||0));return{src:t.src,type:t.type,sizes:t.sizes,largestSize:Math.max.apply(null,e),purpose:t.purpose?t.purpose.split(/\s+/g):["any"]}}function x(l,h){const w=(l.icons||[]).map(v).sort(((t,e)=>e.largestSize-t.largestSize)),x=w.filter((t=>t.purpose.indexOf("any")>-1)),T=w.filter((t=>t.purpose.indexOf("maskable")>-1)),z=(T.length>0?T:x).map((t=>{const e={rel:"icon",href:h(t.src),sizes:t.sizes},n='[sizes="'.concat(t.sizes,'"]');if(b("link",e,'[rel="icon"]'+n),p&&!(t.largestSize<s))return e.rel="apple-touch-icon",b("link",e,'[rel="apple-touch-icon"]'+n)})).filter(Boolean),A=m('meta[name="viewport"]'),E=A&&A.content||"",I=Boolean(E.match(/\bviewport-fit\s*=\s*cover\b/)),R=l.display,M=-1!==e.indexOf(R);if(y("mobile-web-app-capable",M),function(t,e){if(!p&&!d)return;const n=k(t);if(p){y("apple-mobile-web-app-status-bar-style",e?"black-translucent":n?"black":"default")}else{const e=function(){try{return Windows.UI.ViewManagement.ApplicationView.getForCurrentView().titleBar}catch(_){}}();if(!e)return;const o=n?255:0;e.foregroundColor={r:o,g:o,b:o,a:255},e.backgroundColor=function(t){const e=S(t);return{r:e[0],g:e[1],b:e[2],a:e[3]}}(t)}}(l.theme_color||"black",I),u){y("application-name",l.short_name),y("msapplication-tooltip",l.description),y("msapplication-starturl",h(l.start_url||".")),y("msapplication-navbutton-color",l.theme_color);const t=x[0];t&&y("msapplication-TileImage",h(t.src)),y("msapplication-TileColor",l.background_color)}if(y("theme-color",l.theme_color),!p){const t=(B=l.orientation,{por:"portrait",lan:"landscape"}[String(B||"").substr(0,3)]||"");return y("x5-orientation",t),y("screen-orientation",t),void("fullscreen"===R?(y("x5-fullscreen","true"),y("full-screen","yes")):M&&(y("x5-page-mode","app"),y("browsermode","application")))}var B;const L=l.background_color||n,N=k(L),U=function(t){let e;return(t||[]).filter((t=>"itunes"===t.platform)).forEach((t=>{if(t.id)e=t.id;else{const n=t.url.match(/id(\d+)/);n&&(e=n[1])}})),e}(l.related_applications);function D(e,n,s,p){const u=window.devicePixelRatio,d=O({width:e*u,height:n*u});if(d.scale(u,u),d.fillStyle=L,d.fillRect(0,0,e,n),d.translate(e/2,(n-c)/2),p){let t=p.width/u,e=p.height/u;e>r&&(t/=e/r,e=r),t>=i&&e>=i&&(d.drawImage(p,t/-2,e/-2,t,e),d.translate(0,e/2+c))}d.fillStyle=N?"white":"black",d.font="".concat(o,"px ").concat(a);const h=getComputedStyle(f);d.font=h.getPropertyValue("--pwacompat-splash-font");const m=l.name||l.short_name||document.title,g=d.measureText(m),w=g.actualBoundingBoxAscent||o;if(d.translate(0,w),g.width<.8*e)d.fillText(m,g.width/-2,0);else{const t=m.split(/\s+/g);for(let n=1;n<=t.length;++n){const o=t.slice(0,n).join(" "),a=d.measureText(o).width;(n===t.length||a>.6*e)&&(d.fillText(o,a/-2,0),d.translate(0,1.2*w),t.splice(0,n),n=0)}}return()=>{const e=d.canvas.toDataURL();if(t){const t=document.createElement("img");t.src=e,document.body.append(t)}return J(s,e),e}}function J(t,e){const n=document.createElement("link");n.setAttribute("rel","apple-touch-startup-image"),n.setAttribute("media","(orientation: ".concat(t,")")),n.setAttribute("href",e),document.head.appendChild(n)}U&&y("apple-itunes-app","app-id=".concat(U)),y("apple-mobile-web-app-capable",M),y("apple-mobile-web-app-title",l.short_name||l.name);const P=g("iOS");if(!t&&P)try{const t=JSON.parse(P);return J("portrait",t.p),J("landscape",t.l),void z.forEach((e=>{const n=t.i[e.href];n&&(e.href=n)}))}catch(_){}const V={i:{}};function W(t,e){const n=window.screen,o=D(n.width,n.height,"portrait",t),a=D(n.height,n.width,"landscape",t);setTimeout((()=>{V.p=o(),setTimeout((()=>{V.l=a(),e()}),10)}),10)}function q(){g("iOS",JSON.stringify(V))}!function t(){const e=z.shift();if(!e)return void W(null,q);const n=new Image;n.crossOrigin="anonymous",n.onerror=()=>{t()},n.onload=()=>{n.onload=null,W(n,(()=>{const t=l.background_color&&C(n,L);t?(e.href=t,V.i[n.src]=t,function(t){let e=z.length+1;const n=()=>{--e||t()};n(),z.forEach((t=>{const e=new Image;e.crossOrigin="anonymous",e.onerror=n,e.onload=()=>{e.onload=null,t.href=C(e,L,!0),V.i[e.src]=t.href,n()},e.src=t.href}))}(q)):q()}))},n.src=e.href}()}function S(t){const e=O();return e.fillStyle=t,e.fillRect(0,0,1,1),e.getImageData(0,0,1,1).data||[]}function k(t){const e=S(t).map((t=>{const e=t/255;return e<.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=.2126*e[0]+.7152*e[1]+.0722*e[2];return Math.abs(1.05/(n+.05))>3}function C(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=O(t);if(o.drawImage(t,0,0),!n){if(255===o.getImageData(0,0,1,1).data[3])return}return o.globalCompositeOperation="destination-over",o.fillStyle=e,o.fillRect(0,0,t.width,t.height),o.canvas.toDataURL()}function O(){let{width:t,height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1};const n=document.createElement("canvas");return n.width=t,n.height=e,n.getContext("2d")}h=h||{},"complete"===document.readyState?w():window.addEventListener("load",w)}()}}]);
//# sourceMappingURL=pwacompat.45787c79.chunk.js.map